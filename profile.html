<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Karmics - profile</title>

    <!-- Bootstrap Core CSS --><link href="feed/profile/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- MetisMenu CSS --><link href="feed/profile/bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">
    <!-- Timeline CSS --><link href="feed/profile/dist/css/timeline.css" rel="stylesheet">
    <!-- Custom CSS --><link href="feed/profile/dist/css/sb-admin-2.css" rel="stylesheet">
    <!-- Morris Charts CSS --><link href="feed/profile/bower_components/morrisjs/morris.css" rel="stylesheet">
    <!-- Custom Fonts --><link href="feed/profile/bower_components/font-awesome/css/font-awesome.min_updated.css" rel="stylesheet" type="text/css">
    
    <link rel="stylesheet"href="feed/profile/css/chartist.min.css">
    <script src="feed/profile/js/chartist.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Oxygen:300' rel='stylesheet' type='text/css'>
    <link href="feed/profile/css/shop-homepage.css" rel="stylesheet">
    <!-- Firebase -->
  <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>

</head>

<body>
    <script src="js/jquery.js"></script>
    <script>
        //sdfkahskljdfklasjdhkfnj asd
        var user; var snapshotkey; var userKey;
        var karmics; var completions; var awards; var sustainability;
        var linechart;
                $(document).ready(function() {
                    console.log("READY");
                var url = document.location.href;
                var urlP = url.replace(/#^\?/, '').split('&');
                for( i = 0; i < urlP.length; i++ ) {
                    split = urlP[i].split('=');
                    window.user=split[1];
                }
                    var usersRef = new Firebase("https://karmics.firebaseio.com/users");
                    var urlquery=usersRef.orderByChild("username").equalTo(user).on("child_added", function(snapshot) {
                        window.snapshotkey=snapshot.key(); window.userKey=snapshot.key();  console.log(snapshotkey);
                        
                        //console.log("https://karmics.firebaseio.com/users/"+snapshotkey+"/chat");
                        var ref = new Firebase("https://karmics.firebaseio.com/users/"+snapshotkey);
                        ref.child("chat").on("child_added", function(snapshot, prevChildKey) {
                            var newComment = snapshot.val();
                            var profilePic;

                            $("#Chat").append("<li class='left clearfix'><span class='chat-img pull-left'><img src='http://placehold.it/50/55C1E7/fff' alt='User Avatar' class='img-circle' /></span><div class='chat-body clearfix'><div class='header'><strong class='primary-font'>"+newComment.user+"</strong><small class='pull-right text-muted'><i class='fa fa-clock-o fa-fw'></i>"+newComment.date+"</small></div><p>"+newComment.comment+"</p></div></li>");
                        });
                        
                        ref.child("notifications").on("child_added", function(snapshot, prevChildKey) {
                            var newNotification = snapshot.val();
                            $("#notificationPanel").append('<a href="" class="list-group-item"><i class="fa fa-'+notificationType(newNotification.type)+' fa-fw"></i> '+newNotification.notification+'<span class="pull-right text-muted small"><em>'+newNotification.date+'</em></span></a>');
                        });
                        
                        // CHILD CHANGED__________________________________________
                        // Get the data on a post that has changed
                        var ref = new Firebase("https://karmics.firebaseio.com/users/"+snapshotkey);
                        ref.on("child_changed", function(snapshot) {
                            var changedPost = snapshot.val();
                            console.log("CHILD_CHANGED"); refresh();
                        });
                    });
            document.getElementById('btn-chat').disabled=true;
            document.getElementById('user').style.fontSize = "xxx-large";
            //document.getElementById('user').style.left = "100%";
            //document.getElementById('user').style.up = "100%";
            //document.getElementById('user').style.color="#E5E4E2";
               
             console.log("------");
                    console.log("loading profile...");
                    
                });
                ///////////////////////////////////////
                $(window).load(function() {
                        console.log("LOAD");
                        refresh();
                    
                        // CHILD ADDED__________________________________________
                        var ref = new Firebase("https://karmics.firebaseio.com/posts/");
                        //ref=ref.orderByChild("status").equalTo("post");
                        //console.log(user);
                        ref.orderByChild("user").equalTo(user).on("child_added", function(snapshot, prevChildKey) {
                            var newPost = snapshot.val(); window.snapshotkey = snapshot.key();
                            console.log(snapshotkey);
                                $(".timeline").append(leftRight()+'<div class="timeline-badge '+fontAwesomeColor(newPost.status)+'"><i class="fa '+fontAwesome(newPost.status)+'"></i></div><div class="timeline-panel"><div class="timeline-heading"><h4 class="timeline-title" onclick="postOrGoal(\''+snapshotkey+'\',\''+newPost.status+'\')"><a>'+newPost.title+'</a></h4><p><small class="text-muted"><i class="fa '+fontAwesome2(newPost.status)+' fa-lg"></i> '+eval(deadline(newPost.deadline,newPost.status))+'</small></p></div><div class="timeline-body"><div class="thumbnail"><img src="img/'+newPost.url+'"  style="display: block; object-fit:cover;"><h4><i class="fa fa-globe fa-lg"></i> <a>'+newPost.completions+'</a> completions</h4><p></p><p>'+newPost.experience+'<span onclick="postOrGoal(\''+snapshotkey+'\',\''+newPost.status+'\')"><a><font size="4">[...]</font></a></span></p></div></div></div></li>'); console.log("___");
                            comments=0;
                        });
                    });
                //////////////////////////
            var changePage=function(page){
                window.location.href =page+".html?u="+user;
            };
            /*var update = function(){
                lineChart.update({
                                        labels: ["one","two","three"],
                                        series: [[0,1,5000],[0,2,6000],[0,3,7000],[0,4,8000]]
                                        
                                        //"August-2017":5000
                                    },{
                                        width: 500,
                                        height: 300,
                                        showPoint: false
                                        },true);console.log("YA");
            refresh();
            };*/
            var refresh = function(){
                var url="https://karmics.firebaseio.com/users/.json";
                    $.getJSON( url, function( data ) {
                        x=1; y=1;
                        $.each(data,function(key,val){
                            ///////////////// USERNAME
                            if(x==1){
                                if(val.username==user){
                                    console.log("username encontrado"); document.getElementById('user').innerHTML = user;

                                    ////LAST 30 DAYS
                                    
                                        var dataLabels=[];
                                        var dataSeriesBefore=[];
                                        for(var property in val.activity){
                                            var dataSeriesElement=[];
                                            dataLabels.push(property.toString());
                                            for(var prop in val.activity[property]){
                                                //console.log(prop+": "+val.activity[property][prop]);
                                                dataSeriesElement.push(val.activity[property][prop]);
                                            }
                                            dataSeriesBefore.push(dataSeriesElement);
                                        }
                                    var awards=0; var completions=0; var karmics=0; var sustainability=0;
                                        var dataSeries=[];
                                        c=0;
                                        for(var w=0;w<4;w++){
                                                var dataSeriesElement=[];
                                                for(var j=0;j<dataSeriesBefore.length;j++){
                                                    dataSeriesElement.push(dataSeriesBefore[j][w]);
                                                    if(w==0){
                                                        awards+=dataSeriesBefore[j][w];
                                                    }
                                                    else if(w==1){
                                                        completions+=dataSeriesBefore[j][w];
                                                    }
                                                    else if(w==2){
                                                        karmics+=dataSeriesBefore[j][w];
                                                    }
                                                    else if(w==3){
                                                        sustainability+=dataSeriesBefore[j][w];
                                                    }
                                                }
                                                dataSeries.push(dataSeriesElement);
                                        }
                                        dataLabels[0]="Big Bang";
                                        //console.log(dataLabels);
                                        //console.log(dataSeriesBefore);
                                        //console.log(dataSeries);
                                    
                                    lineChart= new Chartist.Line('.ct-chart', {
                                        labels: dataLabels,
                                        series: dataSeries
                                        //[[0,1,500],[0,2,600],[0,3,700],[0,4,800]]
                                    },{
                                        width: 500,
                                        height: 300,
                                        showPoint: false
                                        });
                                    var date = new Date();var m_names = ['January', 'February', 'March', 
                                    'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                                    var month = m_names[date.getMonth()]; var year = date.getFullYear();
                                    var fulldate=month+"-"+year;
                                    /*
                                    karmics=val.activity[fulldate].karmics;
                                    completions=val.activity[fulldate].completions;
                                    awards=val.activity[fulldate].awards;
                                    sustainability=val.activity[fulldate].sustainability;
                                    */
                                    //awards=dataSeriesBefore[dataSeriesBefore.length-1][0];
                                    //completions=dataSeriesBefore[dataSeriesBefore.length-1][1];
                                    //karmics=dataSeriesBefore[dataSeriesBefore.length-1][2];
                                    //sustainability=dataSeriesBefore[dataSeriesBefore.length-1][3];
                                        document.getElementById('karmics').innerHTML = karmics;
                                        document.getElementById('completions').innerHTML = completions;
                                        document.getElementById('awards').innerHTML = awards;
                                        document.getElementById('sustainability').innerHTML = sustainability;
                                        document.getElementById("profilePicture").src="img/"+val.profilePicture;

                                    //PREFERRED CATEGORIES
                                    var data = {
                                        labels: ['Mind', 'Body', 'Spirit'],
                                        series: [val.mind, val.body, val.spirit]
                                    };

                                    var options = {
                                        labelInterpolationFnc: function(value) {
                                            return value[0]
                                        }
                                    };

                                    var responsiveOptions = [
                                        ['screen and (min-width: 640px)', {
                                            chartPadding: 30,
                                            labelOffset: 100,
                                            labelDirection: 'explode',
                                            labelInterpolationFnc: function(value) {
                                                return value;
                                            }
                                        }],['screen and (min-width: 1024px)', {
                                            labelOffset: 0,
                                            chartPadding: 0
                                        }]
                                    ];
                                    new Chartist.Pie('.ct-pie', data, options, responsiveOptions);
                                    
                                    if(val.description!=null){
                                        document.getElementById("description").innerHTML=val.description;
                                    }
                                    x=0;
                                }
                            }
                        });
                    });  
            };
        var newCommentFn = function(){
            var date = new Date();var m_names = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            var month = m_names[date.getMonth()]; var year = date.getFullYear();
            var fulldate=month+"-"+year;
            
            //WRITING DATA WITH PUSH
            var ref = new Firebase("https://karmics.firebaseio.com/users/"+snapshotkey+"/chat/");
            ref.push({
                    //document.getElementById("inputUsername").value
                    "user": user,
                    "comment": document.getElementById("comment-input").value,
                    "date": fulldate
            }, function(error) {
                if (error) {
                    console.log("Data could not be saved." + error);
                } else {
                    console.log("Data saved successfully.");
                }
            });
            document.getElementById("comment-input").value="";
            document.getElementById('btn-chat').disabled=true;
        };
        var enterPress=function(e){
            if (event.which == 13 || event.keyCode == 13) {
            //code to execute here
            return true;
            }
            return false;
        };
        var checkComment = function(){
            if(document.getElementById('comment-input').value==""){
                document.getElementById('btn-chat').disabled=true;
            }
            else{
                document.getElementById('btn-chat').disabled=false;
            }
        };
        var postOrGoal = function(key,status){
                console.log(key);console.log(status);
                if(status=="post"){
                    window.location.href ="post.html?u="+user+"&p="+key;
                }
                else{
                    window.location.href ="goal.html?u="+user+"&g="+key;
                }
            };
        var right;
        var leftRight=function(){
            if(right){
                right=false;
                return '<li class="timeline-inverted">';
            }
            else{
                right=true;
                return '<li>';
            }
        };
        var fontAwesome=function(status){
            //console.log(status);
            if(status=="post"){
                return 'fa-check';
            }
            else{
                return 'fa-sticky-note';
            }
        };
        var fontAwesome2=function(status){
            //console.log(status);
            if(status=="post"){
                return 'fa-calendar';
            }
            else{
                return 'fa-clock-o';
            }
        };
        var fontAwesomeColor=function(status){
            //console.log(status);
            if(status=="post"){
                return 'success';
            }
            else{
                return 'warning';
            }
        };
        var deadline=function(deadline,status){
            if(status=="post"){
                return 'newPost.date';
            }
            else{
                return'newPost.deadline';
            }
        };
        var changeDescription=function(){
            document.getElementById("description").contentEditable=true;
            document.getElementById("descriptionDiv").style.border='2px solid red';
            document.getElementById("descriptionImage").innerHTML=' <i class="fa fa-save fa-2x" onclick="saveDescription()"></i>';
        };
        var saveDescription=function(){
            document.getElementById("description").contentEditable=false;
            document.getElementById("descriptionDiv").style.border='none';
            document.getElementById("descriptionImage").innerHTML=' <i class="fa fa-pencil fa-2x" onclick="changeDescription()"></i>';
            
            var usersRef = new Firebase("https://karmics.firebaseio.com/users/"+userKey);
                var objToWrite = new Object();
                objToWrite.description = document.getElementById("description").innerHTML;
                console.log(objToWrite);
                usersRef.once("value", function(snapshot) {
                    usersRef.update(objToWrite,function(error) {
                        if (error) {
                            console.log("Data could not be saved." + error);
                        } else {
                            console.log("Data saved successfully.");
                        }
                    });
                });
        };
        var notificationType=function(type){
            if(type=="facebook"){
                return "facebook-square";
            }
            else if(type=="reddit"){
                return "reddit-alien";
            }
            else if(type=="twitter"){
                return "twitter";
            }
        }
    </script>
    <style>
.ct-chart .ct-series.ct-series-a .ct-line {
  stroke: #F9DD5F;
}
.ct-chart .ct-series.ct-series-b .ct-line {
  stroke: #62DE64;
}
.ct-chart .ct-series.ct-series-c .ct-line {
  stroke: #3596C8;
}
.ct-chart .ct-series.ct-series-d .ct-line {
  stroke: #E5603A;
}
    </style>
    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">Profile</a>
            </div>
            <!-- /.navbar-header -->

            <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a onclick="changePage('feed')" class="navbar-brand">Home</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a onclick="changePage('chat')">Chat</a>
                    </li>
                    <li>
                        <a href="">My Profile</a>
                    </li>
                    <li>
                        <a href="">Settings</a>
                    </li>
                    <li>
                         <div></div>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav">
                    <div class="thumbnail">
                            <img id="profilePicture" src="img/profile_250x250.jpg" class="img-circle" style="display: block; object-fit:cover;" data-toggle="dropdown"/>
                            <ul class="dropdown-menu" style="position:static" role="menu">
                                <li onclick="console.log('view')"><a>View</a></li>
                                <li class="divider"></li>
                                <li onclick="console.log('take photo')"><a>Take photo</a></li>
                                <li onclick="console.log('upload photo')" data-toggle="modal" data-target="#mymodal"><a>Upload a photo</a></li>
                            </ul>           
                    </div>
                    <div id="descriptionDiv" style="text-align: center;">
                        <p style="display: inline-block;" id="description">Describe yourself here!</p> <span id="descriptionImage"> <i class="fa fa-pencil fa-2x" onclick="changeDescription()"></i></span>
                    </div>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 id="user" class="page-header">User profile</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-globe fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div id="karmics" class="huge">0</div>
                                    <div>Karmics</div>
                                </div>
                            </div>
                        </div>
                        <a href="">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-green">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-check-square-o fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div id="completions" class="huge">0</div>
                                    <div>Completions</div>
                                </div>
                            </div>
                        </div>
                        <a href="">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-yellow">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-trophy fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div id="awards" class="huge">0</div>
                                    <div>Awards</div>
                                </div>
                            </div>
                        </div>
                        <a href="">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-red">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-recycle fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div id="sustainability" class="huge">0</div>
                                    <div>Sustainability</div>
                                </div>
                            </div>
                        </div>
                        <a href="">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-line-chart fa-fw"></i> Activity
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div class="ct-chart"></div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-clock-o fa-fw"></i> Timeline
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <ul class="timeline">
                                <!--
                                <li>
                                    <div class="timeline-badge"><i class="fa fa-check"></i>
                                    </div>
                                    <div class="timeline-panel">
                                        <div class="timeline-heading">
                                            <h4 class="timeline-title"><a>Attend a concert</a></h4>
                                            <p><small class="text-muted"><i class="fa fa-clock-o fa-lg"></i> 01/02/03</small>
                                            </p>
                                        </div>
                                        <div class="timeline-body">
                                            <div class="thumbnail">
                                                <img src="img/concert.png"  style="display: block; object-fit:cover;">
                                                <h4 onclick="postFn(\''+snapshotkey+'\')">
                                                    <i class="fa fa-globe fa-lg"></i> <a>874</a> completions
                                                </h4><p></p>
                                                <p>We went to a local festival with some great bands. Jake Nichols joined the stage!<span onclick="postFn(\''+snapshotkey+'\')"><a><font size="4">[...]</font></a></span></p>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                -->
                            </ul>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-8 -->
                <div class="col-lg-4">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-bell fa-fw"></i> Notifications Panel
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div class="list-group" id="notificationPanel">
                                <!--
                                <a href="" class="list-group-item">
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small"><em>4 minutes ago</em>
                                    </span>
                                </a>
                                <a href="" class="list-group-item">
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small"><em>12 minutes ago</em>
                                    </span>
                                </a>
                                <a href="" class="list-group-item">
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small"><em>27 minutes ago</em>
                                    </span>
                                </a>
                                <a href="" class="list-group-item">
                                    <i class="fa fa-tasks fa-fw"></i> New Goal
                                    <span class="pull-right text-muted small"><em>43 minutes ago</em>
                                    </span>
                                </a>
                                <a href="" class="list-group-item">
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small"><em>11:32 AM</em>
                                    </span>
                                </a>
                                <a href="" class="list-group-item">
                                    <i class="fa fa-bolt fa-fw"></i> Server Crashed!
                                    <span class="pull-right text-muted small"><em>11:13 AM</em>
                                    </span>
                                </a>
                                <a href="" class="list-group-item">
                                    <i class="fa fa-warning fa-fw"></i> Server Not Responding
                                    <span class="pull-right text-muted small"><em>10:57 AM</em>
                                    </span>
                                </a>
                                <a href="" class="list-group-item">
                                    <i class="fa fa-shopping-cart fa-fw"></i> New Order Placed
                                    <span class="pull-right text-muted small"><em>9:49 AM</em>
                                    </span>
                                </a>
                                <a href="" class="list-group-item">
                                    <i class="fa fa-money fa-fw"></i> Payment Received
                                    <span class="pull-right text-muted small"><em>Yesterday</em>
                                    </span>
                                </a>
                                -->
                            </div>
                            <!-- /.list-group -->
                            <a href="" class="btn btn-default btn-block">View All Alerts</a>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-pie-chart fa-fw"></i> Balance
                        </div>
                        <div class="panel-body">
                            <div class="ct-pie"></div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                    <div class="chat-panel panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-comments fa-fw"></i>
                            Public Chat
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <ul class="chat" id="Chat">
                                
                            </ul>
                        </div>
                        <!-- /.panel-body -->
                        <div class="panel-footer">
                            <div class="input-group">
                                <input id="comment-input" onkeyup="if(enterPress(event)){newCommentFn();} checkComment();" type="text" class="form-control input-sm" placeholder="Type your comment here..." />
                                <span class="input-group-btn">
                                    <button class="btn btn-warning btn-sm" id="btn-chat" onclick="newCommentFn()">
                                        Send
                                    </button>
                                </span>
                            </div>
                        </div>
                        <!-- /.panel-footer -->
                    </div>
                    <!-- /.panel .chat-panel -->
                </div>
                <!-- /.col-lg-4 -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->

    </div>
                                <div class="modal fade" id="mymodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                  <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        <h4 class="modal-title" id="myModalLabel">Please choose a file</h4>
                                      </div>
                                      <div class="modal-body">
                                          <progress value="0" max="100" id="uploader" style="-webkit-appearance:none; appearance:none; margin-top:10px; margin-bottom:10px; display:none">0%</progress>
                                          <input type="file" value="upload" id="fileButton" />
                                      </div>
                                      <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary" onclick="uploadFile()" disabled="true" id="uploadButton">Upload</button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="feed/profile/bower_components/jquery/dist/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="feed/profile/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="feed/profile/bower_components/metisMenu/dist/metisMenu.min.js"></script>

    <!-- Morris Charts JavaScript -->
    <script src="feed/profile/bower_components/raphael/raphael-min.js"></script>
    <script src="feed/profile/bower_components/morrisjs/morris.min.js"></script>
    

    <!-- Custom Theme JavaScript -->
    <!-- esto lo quité porque me dió problemas en cuanto metí jquery-> <script src="../dist/js/sb-admin-2.js"></script> -->
    
    
<script src="https://www.gstatic.com/firebasejs/3.6.4/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
    apiKey: "AIzaSyCtvXCT_GQpvpPARuRFv-oOi4nz5eHWLUQ",
    authDomain: "karmics.firebaseapp.com",
    databaseURL: "https://karmics.firebaseio.com",
    storageBucket: "firebase-karmics.appspot.com",
    messagingSenderId: "366737783416"
    };
    firebase.initializeApp(config);
    var file;
    
    fileButton.addEventListener('change',function(e){
            file=e.target.files[0];
            if(file!=null){
                document.getElementById("uploadButton").disabled=false;
            }
            else{
                document.getElementById("uploadButton").disabled=true;
            }
        });
    var uploadFile=function(){
        $('#mymodal').modal('hide');
        if(window.file!=null){
            document.getElementById("uploader").style.display="block";
            var uploader=document.getElementById("uploader");
            var fileButton=document.getElementById("fileButton");
            var storageRef=window.firebase.storage().ref(user+'/'+ /*file.name*/ 'profilePic.jpg');
            var task=storageRef.put(file);
            task.on('state_changed',function progress(snapshot){
                var percentage=(snapshot.bytesTransferred / snapshot.totalBytes)*100;
                uploader.value=percentage;
            },function error(err){
                console.log("error uploading file!");
            },function complete(){
                $('#mymodal').modal('hide');
                document.getElementById("uploadButton").disabled=true;
                document.getElementById("uploader").style.display="none";
                
                //var storageRef = firebase.storage().ref();
                //var tangRef = storageRef.child(user+'/'+ /*file.name*/ 'profilePic.jpg');
                /*firebase.auth().signInAnonymously().then(function() {

                  tangRef.getDownloadURL().then(function(url){
                    console.log(url);
                    document.getElementById('profilePicture').src = url;
                  }).catch(function(error) {
                    console.error(error);
                  });
                });*/
                
                var storageRef = firebase.storage().ref();
                
                console.log('R: '+storageRef.child(user+'/profilePic.jpg').updateMetadata({"key":"value"})['code']);
                console.log('W: '+storageRef.child(user+'/profilessPic.jpg').updateMetadata({"key":"value"})['code']);
                
                storageRef.child(user+'/profilePic.jpg').getDownloadURL().then(function(url) {
                // Or inserted into an <img> element:
                document.getElementById('profilePicture').src = url;
                }).catch(function(error) {
                // Handle any errors
                });
                });
        }
    }
</script>
</body>

</html>
