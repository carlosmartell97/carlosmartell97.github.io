<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="icon" href="../../favicon.ico"> -->

    <title>Karmics - Sign Up</title>

   <!-- Bootstrap Core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">    
      
      <!-- Bootstrap core CSS -->
    <!-- <link href="../bootstrap-3.3.6/dist/css/bootstrap.min.css" rel="stylesheet"> -->

    <!-- Custom styles for this template -->
    <link href="signin.css" rel="stylesheet">
      
      <!-- Custom CSS -->
    <!-- <link href="css/landing-page.css" rel="stylesheet"> -->

    <!-- Custom Fonts -->
    <!-- <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!--  <script src="../../assets/js/ie-emulation-modes-warning.js"></script> -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
  </head>

  <body>

    <div class="container">

      <form class="form-signin">
        <h2 class="form-signin-heading">Please sign up</h2>
        <input type="email" id="inputEmail" class="form-control" placeholder="email" onkeypress="Change()" required autofocus>
        <input type="text" id="inputUsername" class="form-control" placeholder="username" onkeypress="Change()" required>
        <input type="password" id="inputPassword1" class="form-control" placeholder="password" onkeypress="Change()" required>
          <input type="password" id="inputPassword2" class="form-control" placeholder="password again" onkeypress="Change()" required>
        
        <div class="checkbox">
          <label>
            <input type="checkbox" value="remember-me"> Remember me
          </label>
        </div>
          <!-- realmente el href de abajo debería de ser este: ../Feed/feed.html -->
    <button id="SignUpBtn" type="button" class="btn btn-lg btn-default" onclick="myFunction()">Sign up</button>
          <!-- realmente el href de arriba debería de ser este: ../Feed/feed.html -->
      </form>

    </div> <!-- /container -->
      
      <script>
          document.getElementById("SignUpBtn").disabled=true;
          document.getElementById("inputUsername").addEventListener("keydown", Change);
          document.getElementById("inputEmail").addEventListener("keydown", Change);
          document.getElementById("inputPassword1").addEventListener("keydown", Change);
          document.getElementById("inputPassword2").addEventListener("keydown", Change);
          var errorUsername=false;
          //var errorUsername2=false;
          var errorEmail=false;
          var errorPassword=false;
          //window.setTimeout("Checking();", 200);
          setInterval(Checking, 10);
            function myFunction() {
                var url="https://karmics.firebaseio.com/users/.json";
                
                
                // Get a database reference to our posts
                var ref = new Firebase("https://karmics.firebaseio.com/");

                //WRITING DATA WITH SET
                var usersRef = ref.child("users");
                    var username=document.getElementById("inputEmail").value;
                usersRef.push({
                        //document.getElementById("inputUsername").value
                        
                        "email": document.getElementById("inputEmail").value, "username":document.getElementById("inputUsername").value,
                        "password": document.getElementById("inputPassword1").value,
                        "friends":{"1":"no one"}
                    
                }, function(error) {
                    if (error) {
                        console.log("Data could not be saved." + error);
                    } else {
                        console.log("Data saved successfully.");
                        window.location.href = "../feed/feed.html";
                    }
                });
                        console.log("email: "+document.getElementById("inputEmail").value);
                        console.log("pass: "+document.getElementById("inputPassword1").value);
                        
                
            };
          
          function Change(){
                var url="https://karmics.firebaseio.com/users/.json";
            $.getJSON( url, function( data ) {
                /*
                $.each(data,function(key,val){
                    ///////////////// USERNAME
                    if(val.username==document.getElementById("inputUsername").value){
                        console.log("coincidenciaUsername");
                        errorUsername=true;
                        document.getElementById("inputUsername").style.backgroundColor="#F75D59";
                    }
                    else{
                        if(!errorUsername){
                            document.getElementById("inputUsername").style.backgroundColor="white";    
                        }
                        errorUsername=false;
                        
                        
                        
                    }
                    
                });
                */
                
                $.each(data,function(key,val){
                    ///////////////// USERNAME
                    if(val.username==document.getElementById("inputUsername").value){
                        console.log("coincidenciaUsername");
                        errorUsername=true; //errorUsername2=true;                       
                    }
                    /*else{
                        errorUsername2=false;
                    }*/
                    
                    /////////////////// PASSWORD
                    if(document.getElementById("inputPassword1").value!=document.getElementById("inputPassword2").value){
                        console.log("errorPassword");
                        errorPassword=true;
                        document.getElementById("inputPassword1").style.backgroundColor="#F75D59";
                        document.getElementById("inputPassword2").style.backgroundColor="#F75D59";
                    }
                    else{
                        if(!errorPassword){
                            document.getElementById("inputPassword1").style.backgroundColor="white";
                            document.getElementById("inputPassword2").style.backgroundColor="white";
                        }
                        errorPassword=false;
                    }
                    
                    ///////////////// EMAIL
                    if(val.email==document.getElementById("inputEmail").value){
                        console.log("coincidenciaEmail");
                        errorEmail=true;
                        document.getElementById("inputEmail").style.backgroundColor="#F75D59";
                    }
                    else{
                        if(!errorEmail){
                            document.getElementById("inputEmail").style.backgroundColor="white";    
                        }
                        errorEmail=false;
                    }
                });
                if(errorUsername){
                            document.getElementById("inputUsername").style.backgroundColor="#F75D59";
                            errorUsername=false;
                        }
                else{
                    document.getElementById("inputUsername").style.backgroundColor="white";
                    
                }
                
                
                
            });
                
             console.log("------"); 
              
              
              
              Checking();
          };
          function Checking(){
              console.log("Checking...");
              
              if((!(errorPassword) && (document.getElementById("inputUsername").style.backgroundColor=="white") && !(errorEmail))&&((document.getElementById("inputEmail").value!="")&&(document.getElementById("inputUsername").value!="")&&(document.getElementById("inputPassword1").value!="")&&(document.getElementById("inputPassword2").value!=""))){ 
                    
                        document.getElementById("SignUpBtn").disabled=false;
                    
              }else{
                        document.getElementById("SignUpBtn").disabled=true;
                    }
          };
        </script>
        
        <script src="../js/jquery.js"></script>
  </body>
</html>
